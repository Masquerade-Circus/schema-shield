(()=>{var e=class extends Error{message;item;keyword;cause;path="";data;schema;_getCause(e="#"){const t=e+"/"+this.keyword+(void 0!==this.item?"/"+this.item:"");return this.cause?this.cause._getCause(t):(this.path=t,this)}getCause(){return this._getCause()}};function t(t,i){const r=new e(`Invalid ${t}`);r.keyword=t,r.schema=i;return o(`defineError_${t}`,(e,t={})=>(r.message=e,r.item=t.item,r.cause=t.cause,r.data=t.data,r))}function i(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1;return!0}if("object"==typeof e&&"object"==typeof t){if(null===e||null===t)return e===t;const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(const n of r)if(!i(e[n],t[n]))return!1;return!0}return e===t}function r(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function n(e){if(Array.isArray(e)){const t=[];for(let i=0;i<e.length;i++)t[i]=n(e[i]);return t}if(e&&e.constructor&&"Object"!==e.constructor.name)return e;if(r(e)){const t={...e};for(const i in e)t[i]=n(e[i]);return t}return e}function a(e){return r(e)&&"$validate"in e}function o(e,t){return Object.defineProperty(t,"name",{value:e})}var s={time:/^(\d{2}):(\d{2}):(\d{2})(\.\d+)?(Z|([+-])(\d{2}):(\d{2}))$/,uri:/^[a-zA-Z][a-zA-Z0-9+\-.]*:[^\s]*$/,date:/^(\d{4})-(\d{2})-(\d{2})$/,"json-pointer":/^\/(?:[^~]|~0|~1)*$/,"relative-json-pointer":/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/},l=[31,,31,30,31,30,31,31,30,31,30,31],f={"date-time"(e){const t=e.match(/^(\d{4})-(0[0-9]|1[0-2])-(\d{2})T(0[0-9]|1\d|2[0-3]):([0-5]\d):((?:[0-5]\d|60))(?:.\d+)?(?:([+-])(0[0-9]|1\d|2[0-3]):([0-5]\d)|Z)?$/i);if(!t)return!1;let i=Number(t[3]);if("02"===t[2]&&i>29)return!1;const[,r,n,,a,o,s,f,u,d]=t;let m=Number(r),c=Number(n),p=Number(a),y=Number(o),h=Number(s);if("-"===f||"+"===f){const e=Number(u),t=Number(d);if("-"===f?(p+=e,y+=t):"+"===f&&(p-=e,y-=t),y>59?(p+=1,y-=60):y<0&&(p-=1,y+=60),p>23?(i+=1,p-=24):p<0&&(i-=1,p+=24),i>31?(c+=1,i-=31):i<1&&(c-=1,i+=31),c>12?(m+=1,c-=12):c<1&&(m-=1,c+=12),m<0)return!1}return!(i>(2===c?m%4!=0||m%100==0&&m%400!=0?28:29:l[c-1]))&&(60!==h||59===y&&23===p)},uri:e=>s.uri.test(e),email:e=>/^(?!\.)(?!.*\.$)[a-z0-9!#$%&'*+/=?^_`{|}~-]{1,20}(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]{1,21}){0,2}@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,60}[a-z0-9])?){0,3}$/i.test(e),ipv4:e=>/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$/.test(e),ipv6(e){if("::"===e)return!0;if(-1===e.indexOf(":")||/(?:\s+|:::+|^\w{5,}|\w{5}$|^:{1}\w|\w:{1}$)/.test(e))return!1;const t=-1!==e.indexOf(".");let i=e;if(t){i=e.split(":");const t=i.pop();if(!/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$/.test(t))return!1}const r=-1!==e.indexOf("::"),n=t?i.join(":"):e;if(r)return!(n.split("::").length-1>1)&&(!!/^[0-9a-fA-F:.]*$/.test(n)&&/^(?:(?:(?:[0-9a-fA-F]{1,4}(?::|$)){1,6}))|(?:::(?:[0-9a-fA-F]{1,4})){0,5}$/.test(n));const a=/^(?:(?:[0-9a-fA-F]{1,4}:){7}(?:[0-9a-fA-F]{1,4}|:))$/.test(n),o=/(?:[0-9a-fA-F]{5,}|\D[0-9a-fA-F]{3}:)/.test(n);return t?a||!o:a&&!o},hostname:e=>/^[a-z0-9][a-z0-9-]{0,62}(?:\.[a-z0-9][a-z0-9-]{0,62})*[a-z0-9]$/i.test(e),date:e=>"string"==typeof e&&(!1!==s.date.test(e)&&!isNaN(new Date(e).getTime())),regex(e){try{return new RegExp(e),!0}catch(e){return!1}},"json-pointer":e=>""===e||s["json-pointer"].test(e),"relative-json-pointer":e=>""===e||s["relative-json-pointer"].test(e),time:e=>s.time.test(e),duration:!1,"idn-email":!1,"idn-hostname":!1,uuid:!1,"uri-reference":!1,iri:!1,"iri-reference":!1,"uri-template":!1},u={object:e=>r(e),array:e=>!!Array.isArray(e)||"object"==typeof e&&null!==e&&"length"in e&&"0"in e&&Object.keys(e).length-1===e.length,string:e=>"string"==typeof e,number:e=>"number"==typeof e,integer:e=>"number"==typeof e&&e%1==0,boolean:e=>"boolean"==typeof e,null:e=>null===e,timestamp:!1,int8:!1,unit8:!1,int16:!1,unit16:!1,int32:!1,unit32:!1,float32:!1,float64:!1},d={...{required(e,t,i){if(r(t))for(let r=0;r<e.required.length;r++){const n=e.required[r];if(!t.hasOwnProperty(n))return i("Required property is missing",{item:n,data:t[n]})}},properties(e,t,i){if(r(t))for(const n of Object.keys(e.properties))if(t.hasOwnProperty(n)){if("boolean"!=typeof e.properties[n]){if("$validate"in e.properties[n]){const r=e.properties[n].$validate(t[n]);if(r)return i("Property is invalid",{item:n,cause:r,data:t[n]})}}else if(!1===e.properties[n])return i("Property is not allowed",{item:n,data:t[n]})}else{const i=e.properties[n];r(i)&&"default"in i&&(t[n]=i.default)}},values(e,t,i){if(!r(t)||!a(e.values))return;const n=Object.keys(t);for(const r of n){const n=e.values.$validate(t[r]);if(n)return i("Property is invalid",{item:r,cause:n,data:t[r]})}},maxProperties(e,t,i){if(r(t)&&!(Object.keys(t).length<=e.maxProperties))return i("Too many properties",{data:t})},minProperties(e,t,i){if(r(t)&&!(Object.keys(t).length>=e.minProperties))return i("Too few properties",{data:t})},additionalProperties(e,t,i){if(!r(t))return;const n=Object.keys(t),o=a(e.additionalProperties);for(const r of n)if(!e.properties||!e.properties.hasOwnProperty(r)){if(e.patternProperties){let t=!1;for(const i in e.patternProperties)if(new RegExp(i,"u").test(r)){t=!0;break}if(t)continue}if(!1===e.additionalProperties)return i("Additional properties are not allowed",{item:r,data:t[r]});if(o){const n=e.additionalProperties.$validate(t[r]);if(n)return i("Additional properties are invalid",{item:r,cause:n,data:t[r]})}}},patternProperties(e,t,i){if(!r(t))return;const n=Object.keys(e.patternProperties);for(const r of n){const n=new RegExp(r,"u");if("boolean"==typeof e.patternProperties[r]){if(!1===e.patternProperties[r])for(const e in t)if(n.test(e))return i("Property is not allowed",{item:e,data:t[e]});continue}const a=Object.keys(t);for(const o of a)if(n.test(o)&&"$validate"in e.patternProperties[r]){const n=e.patternProperties[r].$validate(t[o]);if(n)return i("Property is invalid",{item:o,cause:n,data:t[o]})}}},propertyNames(e,t,i){if(r(t)){if("boolean"==typeof e.propertyNames&&!1===e.propertyNames&&Object.keys(t).length>0)return i("Properties are not allowed",{data:t});if(a(e.propertyNames))for(let r in t){const n=e.propertyNames.$validate(r);if(n)return i("Property name is invalid",{item:r,cause:n,data:t[r]})}}},dependencies(e,t,i){if(r(t))for(const r in e.dependencies){if(r in t==!1)continue;const n=e.dependencies[r];if(Array.isArray(n)){for(let e=0;e<n.length;e++)if(!(n[e]in t))return i("Dependency is not satisfied",{item:e,data:n[e]});continue}if("boolean"==typeof n){if(n)continue;return i("Dependency is not satisfied",{data:n})}if("string"==typeof n){if(n in t)continue;return i("Dependency is not satisfied",{data:n})}const a=n.$validate(t);if(a)return i("Dependency is not satisfied",{cause:a,data:t})}},then:!1,else:!1,default:!1,$ref:!1,definitions:!1,$id:!1,$schema:!1,title:!1,description:!1,$comment:!1,examples:!1,contentMediaType:!1,contentEncoding:!1,discriminator:!1,nullable:!1},...{items(e,t,i){if(!Array.isArray(t))return;const r=e.items,n=t.length;if("boolean"==typeof r)return!1===r&&n>0?i("Array items are not allowed",{data:t}):void 0;if(Array.isArray(r)){const e=r.length,o=Math.min(e,n);for(let e=0;e<o;e++){const n=r[e];if("boolean"!=typeof n){if(a(n)){const r=n.$validate(t[e]);if(r)return i("Array item is invalid",{item:e,cause:r,data:t[e]})}}else if(!1===n&&void 0!==t[e])return i("Array item is not allowed",{item:e,data:t[e]})}}else if(a(r))for(let e=0;e<n;e++){const n=r.$validate(t[e]);if(n)return i("Array item is invalid",{item:e,cause:n,data:t[e]})}},elements(e,t,i){if(Array.isArray(t)&&a(e.elements))for(let r=0;r<t.length;r++){const n=e.elements.$validate(t[r]);if(n)return i("Array item is invalid",{item:r,cause:n,data:t[r]})}},minItems(e,t,i){if(Array.isArray(t)&&!(t.length>=e.minItems))return i("Array is too short",{data:t})},maxItems(e,t,i){if(Array.isArray(t)&&!(t.length<=e.maxItems))return i("Array is too long",{data:t})},additionalItems(e,t,i){if(e.items&&!r(e.items)){if(!1===e.additionalItems)return t.length>e.items.length?i("Array is too long",{data:t}):void 0;if(r(e.additionalItems)){if(a(e.additionalItems)){for(let r=e.items.length;r<t.length;r++){const n=e.additionalItems.$validate(t[r]);if(n)return i("Array item is invalid",{item:r,cause:n,data:t[r]})}return}}else;}},uniqueItems(e,t,i){if(!Array.isArray(t)||!e.uniqueItems)return;const n=new Set;for(const e of t){let t;if(t="string"==typeof e?`s:${e}`:r(e)?`o:${JSON.stringify(Object.fromEntries(Object.entries(e).sort(([e],[t])=>e.localeCompare(t))))}`:Array.isArray(e)?JSON.stringify(e):String(e),n.has(t))return i("Array items are not unique",{data:e});n.add(t)}},contains(e,t,i){if(Array.isArray(t)){if("boolean"==typeof e.contains)return e.contains?0===t.length?i("Array must contain at least one item",{data:t}):void 0:i("Array must not contain any items",{data:t});for(let i=0;i<t.length;i++){if(!e.contains.$validate(t[i]))return}return i("Array must contain at least one item",{data:t})}}},...{minLength(e,t,i){if(!("string"!=typeof t||t.length>=e.minLength))return i("Value is shorter than the minimum length",{data:t})},maxLength(e,t,i){if(!("string"!=typeof t||t.length<=e.maxLength))return i("Value is longer than the maximum length",{data:t})},pattern(e,t,i){if("string"!=typeof t)return;const r=new RegExp(e.pattern,"u");return r instanceof RegExp==!1?i("Invalid regular expression",{data:t}):r.test(t)?void 0:i("Value does not match the pattern",{data:t})},format(e,t,i,r){if("string"!=typeof t)return;const n=r.getFormat(e.format);return n&&!n(t)?i("Value does not match the format",{data:t}):void 0}},...{minimum(e,t,i,r){if("number"!=typeof t)return;let n=e.minimum;return"number"==typeof e.exclusiveMinimum?n=e.exclusiveMinimum+1e-15:!0===e.exclusiveMinimum&&(n+=1e-15),t<n?i("Value is less than the minimum",{data:t}):void 0},maximum(e,t,i,r){if("number"!=typeof t)return;let n=e.maximum;return"number"==typeof e.exclusiveMaximum?n=e.exclusiveMaximum-1e-15:!0===e.exclusiveMaximum&&(n-=1e-15),t>n?i("Value is greater than the maximum",{data:t}):void 0},multipleOf(e,t,i,r){if("number"!=typeof t)return;const n=t/e.multipleOf;return isFinite(n)?function(e,t,i=1e-15){return Math.abs(e-t)<=i*Math.max(Math.abs(e),Math.abs(t))}(n,Math.round(n))?void 0:i("Value is not a multiple of the multipleOf",{data:t}):void 0},exclusiveMinimum(e,t,i,r){if("number"==typeof t&&"number"==typeof e.exclusiveMinimum&&!("minimum"in e))return t<=e.exclusiveMinimum+1e-15?i("Value is less than or equal to the exclusiveMinimum"):void 0},exclusiveMaximum(e,t,i,r){if("number"==typeof t&&"number"==typeof e.exclusiveMaximum&&!("maximum"in e))return t>=e.exclusiveMaximum?i("Value is greater than or equal to the exclusiveMaximum",{data:t}):void 0}},...{enum(e,t,r){const n=Array.isArray(t),a="object"==typeof t&&null!==t;for(let r=0;r<e.enum.length;r++){const o=e.enum[r];if(o===t)return;if((n&&Array.isArray(o)||a&&"object"==typeof o&&null!==o)&&i(o,t))return}return r("Value is not one of the allowed values",{data:t})},allOf(e,t,i){for(let n=0;n<e.allOf.length;n++)if(r(e.allOf[n])){if("$validate"in e.allOf[n]){const r=e.allOf[n].$validate(t);if(r)return i("Value is not valid",{cause:r,data:t})}}else if("boolean"!=typeof e.allOf[n]){if(t!==e.allOf[n])return i("Value is not valid",{data:t})}else if(Boolean(t)!==e.allOf[n])return i("Value is not valid",{data:t})},anyOf(e,t,i){for(let i=0;i<e.anyOf.length;i++){if(r(e.anyOf[i])){if("$validate"in e.anyOf[i]){if(!e.anyOf[i].$validate(t))return;continue}return}if("boolean"==typeof e.anyOf[i]&&Boolean(t)===e.anyOf[i])return;if(t===e.anyOf[i])return}return i("Value is not valid",{data:t})},oneOf(e,t,i){let n=0;for(let i=0;i<e.oneOf.length;i++)if(r(e.oneOf[i])){if("$validate"in e.oneOf[i]){e.oneOf[i].$validate(t)||n++;continue}n++}else"boolean"!=typeof e.oneOf[i]?t===e.oneOf[i]&&n++:Boolean(t)===e.oneOf[i]&&n++;if(1!==n)return i("Value is not valid",{data:t})},const(e,t,n){if(!(t===e.const||r(t)&&r(e.const)&&i(t,e.const)||Array.isArray(t)&&Array.isArray(e.const)&&i(t,e.const)))return n("Value is not valid",{data:t})},if(e,t,i){if("then"in e==!1&&"else"in e==!1)return;if("boolean"==typeof e.if){if(e.if){if(a(e.then))return e.then.$validate(t)}else if(a(e.else))return e.else.$validate(t);return}if(!a(e.if))return;return e.if.$validate(t)?a(e.else)?e.else.$validate(t):void 0:a(e.then)?e.then.$validate(t):void 0},not(e,t,i){if("boolean"==typeof e.not)return e.not?i("Value is not valid",{data:t}):void 0;if(r(e.not)){if("$validate"in e.not){const r=e.not.$validate(t);return r?void 0:i("Value is not valid",{cause:r,data:t})}return i("Value is not valid",{data:t})}return i("Value is not valid",{data:t})}}},m={SchemaShield:class{types={};formats={};keywords={};immutable=!1;constructor({immutable:e=!1}={}){this.immutable=e;for(const[e,t]of Object.entries(u))t&&this.addType(e,t);for(const[e,t]of Object.entries(d))this.addKeyword(e,t);for(const[e,t]of Object.entries(f))t&&this.addFormat(e,t)}addType(t,i,r=!1){if(this.types[t]&&!r)throw new e(`Type "${t}" already exists`);this.types[t]=i}getType(e){return this.types[e]}addFormat(t,i,r=!1){if(this.formats[t]&&!r)throw new e(`Format "${t}" already exists`);this.formats[t]=i}getFormat(e){return this.formats[e]}addKeyword(t,i,r=!1){if(this.keywords[t]&&!r)throw new e(`Keyword "${t}" already exists`);this.keywords[t]=i}getKeyword(e){return this.keywords[e]}compile(t){const i=this.compileSchema(t);if(!i.$validate){if(!1===this.isSchemaLike(t))throw new e("Invalid schema");i.$validate=o("any",()=>{})}const r=e=>{const t=this.immutable?n(e):e,r=i.$validate(t);return{data:t,error:r||null,valid:!r}};return r.compiledSchema=i,r}compileSchema(e){r(e)||(e=!0===e?{anyOf:[{}]}:!1===e?{oneOf:[]}:{oneOf:[e]});const i={...e},n=t("type",e),a=[];let s="";if("type"in e){const t=Array.isArray(e.type)?e.type:e.type.split(",").map(e=>e.trim());for(const e of t){const t=this.getType(e);t&&(a.push(t),s+=(s?"_OR_":"")+t.name)}const r=a.length;if(0===r)throw n("Invalid type for schema",{data:e.type});if(1===r){const e=a[0];i.$validate=o(s,t=>{if(!e(t))return n("Invalid type",{data:t})})}else r>1&&(i.$validate=o(s,e=>{for(let t=0;t<r;t++)if(a[t](e))return;return n("Invalid type",{data:e})}))}for(const n of Object.keys(e)){if("type"===n){i.type=e.type;continue}const a=this.getKeyword(n);if(a){const r=t(n,e[n]);if(i.$validate){const e=i.$validate;s+=`_AND_${a.name}`,i.$validate=o(s,t=>{const n=e(t);return n||a(i,t,r,this)})}else s=a.name,i.$validate=o(s,e=>a(i,e,r,this))}r(e[n])?i[n]=this.compileSchema(e[n]):Array.isArray(e[n])?i[n]=e[n].map((e,t)=>this.isSchemaLike(e)?this.compileSchema(e):e):i[n]=e[n]}return i}isSchemaLike(e){if(r(e)){if("type"in e)return!0;for(let t in e)if(t in this.keywords)return!0}return!1}}};"undefined"!=typeof module?module.exports=m:self.SchemaShield=m})();//# sourceMappingURL=index.min.js.map